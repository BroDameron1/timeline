<% layout('layouts/boilerplate.ejs') %>

<div class="disableDiv">
    <div class="warning-popup">
        Confirm you want to delete this record by typing DELETE and clicking "Delete".
        <form action="" id="delete-confirmation">
            <div class="form-field"><input type="text" id="delete-validate" autofocus></div>
        <div class="popup-btn-container">
            <button class="btn-red btn-margins">Delete</button>
        </form>
        <button class="btn-blue btn-margins">Cancel</button>
    </div>
    </div>
</div>


<div class="pending-container">
    <div class="user-header">
        Placeholder for user info
    </div>
    <div class="record-column">
        <div class="column-header">
            Pending Submissions
        </div>
        <% for(let pendingRequest of viewablePendingRequests) { %>
            <% if (currentUser._id.equals(pendingRequest.reviewRecord.author[0]._id) && (pendingRequest.reviewRecord.state === 'new' || pendingRequest.reviewRecord.state === 'update')) { %>
                <div class="column-entry">
                    <div class="record-title">Record: <%= pendingRequest.reviewRecord.title %></div>
                    <div class="record-date">Last Update: <%= pendingRequest.reviewRecord.updateDate %> </div>
                    <div class="record-state">
                        <div class="state-container">
                            <%= pendingRequest.reviewRecord.state.charAt(0).toUpperCase() + pendingRequest.reviewRecord.state.slice(1) %> <%= pendingRequest.reviewRecord.recordType %> 
                        </div>
                    </div>
                    <% if (!pendingRequest.reviewRecord.checkedOut) { %> 
                    <div class="record-button"><a href="<%= pendingRequest.reviewRecord.recordProps.reviewUrl %>/edit/"><button class="btn-blue">Edit</button></a></div>
                    <div class="record-button">
                        <form action="<%= pendingRequest.reviewRecord.recordProps.reviewUrl %>?_method=DELETE" method="POST" class="delete-record">
                            <button class="btn-red">Delete</button>
                        </form>
                    </div>
                    <% } else { %>
                        <div class="record-button"><button class="btn-disabled">Locked</button></div>
                        <div class="record-button"><button class="btn-disabled">Locked</button></div>
                    <% } %> 
                </div>
            <% } %>
        <% } %>
    </div>
    <div class="record-column">
        <div class="column-header">
            Reviewed
        </div>
        <% for(let pendingRequest of viewablePendingRequests) { %>
            <% if (pendingRequest.state === 'approved' || pendingRequest.reviewRecord.state === 'rejected') { %>
                <div class="column-entry">
                    <div class="record-title">Record: <%= pendingRequest.reviewRecord.title %></div>
                    <div class="record-date">Last Update: <%= pendingRequest.reviewRecord.updateDate %></div>
                    <div class="record-state">
                        <div class="state-container">
                            <%= pendingRequest.reviewRecord.state.charAt(0).toUpperCase() + pendingRequest.reviewRecord.state.slice(1) %>
                        </div>
                    </div>
                    <div class="record-button"></div>
                    <div class="record-button">
                        <a href="<%= pendingRequest.reviewRecord.recordProps.reviewUrl %>/view/"><button class="btn-blue">View Notes</button></a>
                    </div>
                </div>
            <% } %>
        <% } %>
    </div>
    <% if (currentUser.role === 'admin') { %>
        <div class="record-column">
            <div class="column-header">
                To Be Reviewed
            </div>
            <% for(let pendingRequest of viewablePendingRequests) { %>
                <% if (currentUser.role === 'admin' && !currentUser._id.equals(pendingRequest.reviewRecord.author[0]._id)) { %>
                    <div class="column-entry">
                        <div class="record-title">Record: <%= pendingRequest.reviewRecord.title %></div>
                        <div class="record-date">Last Update: <%= pendingRequest.reviewRecord.updateDate %></div>
                        <div class="record-state">
                            <div class="state-container">
                                <%= pendingRequest.reviewRecord.state.charAt(0).toUpperCase() + pendingRequest.reviewRecord.state.slice(1) %> <%= pendingRequest.reviewRecord.recordType %> 
                            </div>
                        </div>
                        <div></div>
                        <% if (!pendingRequest.reviewRecord.checkedOut) { %> 
                        <div class="record-button"><a href="<%= pendingRequest.reviewRecord.recordProps.reviewUrl %>"><button class="btn-blue">Review</button></a></div>
                        <% } else { %> 
                        <div class="record-button"><button class="btn-disabled">Locked</button></div>
                        <% } %> 
                    </div>
                
            <% } %>
        <% } %>
        </div>
    <% } %>
</div>

    <script type="module" src="/js/dashboard.js"></script>

